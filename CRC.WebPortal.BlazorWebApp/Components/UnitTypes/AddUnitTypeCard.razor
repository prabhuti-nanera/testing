@using Microsoft.AspNetCore.Components

<div class="add-unit-type-card-container">
    @if (IsAdding)
    {
        <div class="unit-type-card adding">
            <input type="text" 
                   @bind="NewUnitTypeName" 
                   @onblur="SaveNewUnitType" 
                   @onkeypress="OnKeyPress"
                   class="add-unit-type-input"
                   placeholder="Unit Type"
                   @ref="inputElement" />
        </div>
    }
    else
    {
        <div class="add-unit-type-card" @onclick="StartAdding">
            <i class="bi bi-plus"></i>
        </div>
    }
</div>

@code {
    [Parameter] public EventCallback<string> OnAdd { get; set; }

    private bool IsAdding = false;
    private string NewUnitTypeName = string.Empty;
    private ElementReference inputElement;

    private async Task StartAdding()
    {
        IsAdding = true;
        NewUnitTypeName = string.Empty;
        StateHasChanged();
        await Task.Delay(10);
        await inputElement.FocusAsync();
    }

    private async Task SaveNewUnitType()
    {
        if (!string.IsNullOrWhiteSpace(NewUnitTypeName))
        {
            await OnAdd.InvokeAsync(NewUnitTypeName.Trim());
        }
        
        IsAdding = false;
        NewUnitTypeName = string.Empty;
    }

    private async Task OnKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SaveNewUnitType();
        }
        else if (e.Key == "Escape")
        {
            IsAdding = false;
            NewUnitTypeName = string.Empty;
        }
    }
}

<style>
    .add-unit-type-card-container {
        display: inline-block;
        margin: 6px;
    }

    .add-unit-type-card {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border: 1px dashed #6366f1;
        background: transparent;
        color: #6366f1;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: bold;
        margin: 2px;
    }

    .add-unit-type-card:hover {
        background: rgba(102, 126, 234, 0.1);
        border-color: #764ba2;
        color: #764ba2;
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }

    .unit-type-card.adding {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #10b981;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        min-width: 100px;
        min-height: 32px;
        box-shadow: 0 1px 3px rgba(16, 185, 129, 0.3);
        margin: 2px;
    }

    .add-unit-type-input {
        background: rgba(255,255,255,0.9);
        border: 1px solid rgba(255,255,255,0.5);
        color: #333;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 500;
        width: 100%;
        text-align: center;
        outline: none;
    }

    .add-unit-type-input:focus {
        border-color: white;
        background: white;
    }

    .add-unit-type-input::placeholder {
        color: rgba(51, 51, 51, 0.7);
    }
</style>
